<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DOMO Embed</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, sans-serif;
      background: #f7f7f8;
      display: flex;
      justify-content: center;
    }
    iframe {
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
 <iframe
  id="domoFrame"
  src="https://embed.domo.com/embed/pages/4Qp3J"
  width="1248" height="1620" frameborder="0">
</iframe>

<script>
const frame = document.getElementById('domoFrame');

function decodePfilters(url) {
  try {
    const u = new URL(url);
    const pf = u.searchParams.get('pfilters');
    if (!pf) return null;
    return JSON.parse(decodeURIComponent(pf));
  } catch (e) {
    return null;
  }
}

function logState(tag) {
  const pfilters = decodePfilters(frame.src);
  console.log(tag, { src: frame.src, pfilters });
  // Example: push to analytics
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({ event: 'domoPfilters', src: frame.src, pfilters });
}

// Fires when iframe reloads (e.g., when you navigate to x68r9?pfilters=...)
frame.addEventListener('load', () => logState('iframe loaded'));

// Detect programmatic changes to frame.src (if your code sets it)
new MutationObserver(muts => {
  for (const m of muts) {
    if (m.type === 'attributes' && m.attributeName === 'src') {
      logState('iframe src changed');
    }
  }
}).observe(frame, { attributes: true, attributeFilter: ['src'] });
</script>
</body>
</html>
